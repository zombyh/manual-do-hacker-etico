## ğŸ“˜ Resumo: AnÃ¡lise EstÃ¡tica AvanÃ§ada e CodificaÃ§Ã£o â€“ Parte II

### ğŸ“Œ Objetivos da Aula
- Identificar chamadas de funÃ§Ãµes e passagem de parÃ¢metros em Assembly.
- Utilizar o IDA Pro para anÃ¡lise estÃ¡tica de binÃ¡rios.
- Relacionar estruturas de cÃ³digo em C com sua representaÃ§Ã£o em Assembly.

---

## ğŸ§© FunÃ§Ãµes em Assembly

### ğŸ” O que sÃ£o funÃ§Ãµes?
- Blocos de cÃ³digo que executam uma tarefa especÃ­fica.
- Relativamente independentes do restante do programa.
- Chamadas pelo cÃ³digo principal via instruÃ§Ã£o `call`.

### ğŸ§± Estrutura de uma FunÃ§Ã£o
1. **PrÃ³logo**:  
   - `push ebp`  
   - `mov ebp, esp`  
   - Aloca espaÃ§o na pilha para variÃ¡veis locais.

2. **Corpo**:  
   - ExecuÃ§Ã£o da lÃ³gica da funÃ§Ã£o.

3. **EpÃ­logo**:  
   - `pop ebp`  
   - `ret`  
   - Restaura a pilha e retorna ao chamador.

### ğŸ“¤ Passagem de ParÃ¢metros
- ParÃ¢metros sÃ£o passados via **pilha** (instruÃ§Ãµes `push` ou `mov`).
- ConvenÃ§Ã£o de chamada define a ordem e a limpeza da pilha.

---

## ğŸ› ï¸ IDA Pro: Ferramenta de Desmontagem

### ğŸ“¥ Carregamento de Arquivos
- Reconhece automaticamente formatos: PE (Windows), ELF (Linux), etc.
- OpÃ§Ã£o de carregamento manual para incluir cabeÃ§alhos e seÃ§Ãµes ocultas.

### ğŸ¨ Modos de VisualizaÃ§Ã£o
- **Modo GrÃ¡fico**:  
  - Fluxo do programa com setas coloridas:  
    - ğŸ”´ Vermelho: condiÃ§Ã£o falsa  
    - ğŸŸ¢ Verde: condiÃ§Ã£o verdadeira  
    - ğŸ”µ Azul: salto incondicional  
  - Setas para cima indicam loops.

- **Modo Texto**:  
  - VisualizaÃ§Ã£o tradicional do cÃ³digo desmontado.

### ğŸªŸ Janelas Principais
| Janela | FunÃ§Ã£o |
|--------|--------|
| **FunÃ§Ãµes** | Lista funÃ§Ãµes e tamanhos |
| **Strings** | Exibe strings ASCII no binÃ¡rio |
| **ExportaÃ§Ã£o** | FunÃ§Ãµes exportadas (Ãºtil em DLLs) |
| **Nomes** | EndereÃ§os nomeados (funÃ§Ãµes, dados, strings) |
| **ImportaÃ§Ã£o** | FunÃ§Ãµes importadas de outras bibliotecas |
| **Estruturas** | Layout de estruturas de dados |

### ğŸ” Recursos AvanÃ§ados
- **ReferÃªncia Cruzada (XRef)**:  
  - Mostra onde uma funÃ§Ã£o/string Ã© usada.  
  - Acesso via tecla `x` sobre o item.

- **RenomeaÃ§Ã£o de FunÃ§Ãµes/VariÃ¡veis**:  
  - Permite dar nomes significativos durante a anÃ¡lise.

- **Busca**:  
  - Texto, sequÃªncia de bytes, opcodes.

---

## ğŸ” CÃ³digo em C vs Assembly

### ğŸ§® OperaÃ§Ãµes AritmÃ©ticas
**Exemplo em C**:
```c
int x = 4;
int y = 5;
x = x + 12;
x = x - y;
y++;
x--;
```
**Assembly correspondente**:
```asm
mov dword ptr [esp+0Ch], 4   ; x = 4
mov dword ptr [esp+8], 5     ; y = 5
add dword ptr [esp+0Ch], 0Ch ; x += 12
mov eax, [esp+8]             ; copia y para eax
sub [esp+0Ch], eax           ; x -= y
add dword ptr [esp+8], 1     ; y++
sub dword ptr [esp+0Ch], 1   ; x--
```

### ğŸ”€ Estruturas Condicionais (if-else)
**Exemplo em C**:
```c
if (y == x) {
    printf("x igual a y.");
} else {
    printf("x diferente de y.");
}
```
**Assembly**:
- `cmp`: compara valores
- `jnz` (jump if not zero): salta se forem diferentes

### ğŸ” Estruturas de RepetiÃ§Ã£o (for)
**Componentes**:
- InicializaÃ§Ã£o
- ComparaÃ§Ã£o
- InstruÃ§Ãµes do loop
- Incremento/Decremento

**Exemplo em Assembly**:
```asm
mov dword ptr [esp+1Ch], 0   ; i = 0
jmp short loc_401539
loc_40152@:
...                           ; corpo do loop
add dword ptr [esp+1Ch], 1   ; i++
loc_401539:
cmp dword ptr [esp+1Ch], 9   ; i < 10?
jle short loc_40152@         ; salta se i <= 9
```

### ğŸ”€ Estrutura Switch-Case
- Compara uma variÃ¡vel com vÃ¡rios casos.
- Usa `cmp` e `jz`/`jnz` para saltar para o caso correspondente.
- `default` Ã© tratado como um salto incondicional.

---

## ğŸ§ª Exemplo: Chamada de FunÃ§Ã£o

**CÃ³digo em C**:
```c
int soma(int a, int b) {
    return a + b;
}

int main() {
    int x = 2, y = 4;
    printf("Valor retornado: %d", soma(x, y));
}
```

**Assembly**:
- ParÃ¢metros `x` e `y` sÃ£o movidos para `esp+4` e `esp`.
- Chamada da funÃ§Ã£o `soma` via `call`.
- Retorno em `eax` Ã© passado para `printf`.

---

## âœ… Dicas para AnÃ¡lise
- **NÃ£o se perca em instruÃ§Ãµes individuais**: agrupe-as mentalmente.
- **Identifique padrÃµes**: loops, condiÃ§Ãµes, chamadas de sistema.
- **Use XRefs**: para rastrear uso de funÃ§Ãµes e strings.
- **Renomeie sÃ­mbolos**: para simplificar a anÃ¡lise.

---

## ğŸ“š ReferÃªncias
- SIKORSKI, M. **Practical Malware Analysis**
- TANENBAUM, A.S. **OrganizaÃ§Ã£o Estruturada de Computadores**

---
