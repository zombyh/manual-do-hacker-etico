## ğŸ“˜ Resumo: AnÃ¡lise de MemÃ³ria no Windows com Volatility

### ğŸ¯ Objetivo da Aula
- Identificar vantagens do uso do **Volatility**.
- Reconhecer tÃ©cnicas de **aquisiÃ§Ã£o de memÃ³ria**.
- Compreender **recursos internos do Windows** para anÃ¡lise forense.

---

## ğŸ§  TÃ³picos Principais

### 1. IntroduÃ§Ã£o Ã  AnÃ¡lise de MemÃ³ria
- Muitas vezes o analista nÃ£o recebe o malware, mas sim a mÃ¡quina infectada.
- A anÃ¡lise de memÃ³ria permite:
  - Ver processos em execuÃ§Ã£o.
  - Identificar conexÃµes de rede.
  - Recuperar comandos recentes.
  - Encontrar dados **apenas em RAM**: chaves de criptografia, cÃ³digo injetado, e-mails nÃ£o criptografados, etc.

---

### 2. Volatility Framework
- Ferramenta de cÃ³digo aberto em Python.
- Usada para extrair artefatos de amostras de memÃ³ria RAM.
- Suporta Windows, Linux e macOS (32 e 64 bits).
- Modular e extensÃ­vel, com suporte da comunidade.

#### âŒ O que o Volatility **nÃ£o Ã©**:
- NÃ£o Ã© ferramenta de aquisiÃ§Ã£o de memÃ³ria.
- NÃ£o possui interface grÃ¡fica.
- NÃ£o Ã© imune a erros.

**Exemplo de comando:**
```bash
python vol.py -f memory.dmp --profile=Win7SP1x64 pslist
```

---

### 3. AquisiÃ§Ã£o de MemÃ³ria
- CÃ³pia da memÃ³ria volÃ¡til para armazenamento nÃ£o volÃ¡til.
- Requer planejamento e ferramentas robustas.

#### ğŸ› ï¸ Ferramentas de AquisiÃ§Ã£o:
- **AccessData FTK Imager**
- **MoonSols Windows Memory Toolkit**
- **Winpmem** (cÃ³digo aberto)
- **FastDump**, **Memoryze**

---

### 4. Estruturas do Windows na MemÃ³ria

#### ğŸ” Objetos do Kernel
- Estruturas em C (`ExecutiveObjects`) organizam dados do sistema.
- Exemplo: `_POOL_HEADER` em alocaÃ§Ãµes de kernel.

#### ğŸ” Processos
- Cada processo tem espaÃ§o de memÃ³ria virtual isolado.
- ContÃ©m: executÃ¡vel, DLLs, stacks, heaps, variÃ¡veis de ambiente.

#### ğŸ” Plugins do Volatility para Processos:
- `pslist`: Lista processos (pode nÃ£o mostrar ocultos).
- `pstree`: Mostra relaÃ§Ã£o pai-filho.
- `psscan`: Busca por `_EPROCESS` (encontra processos ocultos).
- `psxview`: Compara listas de processos para detectar discrepÃ¢ncias.

#### ğŸ” VariÃ¡veis de Ambiente
- Apontadas pela `PEB` (Process Environment Block).
- Malwares podem criar variÃ¡veis para persistÃªncia.

#### ğŸ” Registro do Windows
- Banco de dados de configuraÃ§Ãµes do sistema.
- Mapeado na memÃ³ria durante a execuÃ§Ã£o.
- Pode conter:
  - Programas executados recentemente.
  - Hashes de senhas.
  - Chaves maliciosas.

---

### 5. InjeÃ§Ã£o de CÃ³digo
- TÃ©cnica para executar cÃ³digo malicioso dentro de processos legÃ­timos.

#### ğŸ¯ Tipos de InjeÃ§Ã£o:
- **InjeÃ§Ã£o Remota de DLL**: Carrega DLL do disco via `LoadLibrary`.
- **InjeÃ§Ã£o Remota de CÃ³digo**: Escreve cÃ³digo diretamente no processo.
- **InjeÃ§Ã£o Reflexiva de DLL**: DLL Ã© carregada da memÃ³ria, sem arquivo em disco.
- **Process Hollowing**: Substitui cÃ³digo de processo legÃ­timo suspenso.

---

### 6. InvestigaÃ§Ã£o de Rede
- Malwares usam rede para C2, propagaÃ§Ã£o, backdoor.

#### ğŸ”Œ Tipos de Artefatos de Rede:
- **Sockets**: Criados via Winsock, WinINet ou TDI (kernel).
- **ConexÃµes**: Cliente/servidor.

#### ğŸ§© Objetivos do Analista:
- Identificar portas abertas suspeitas.
- Detectar conexÃµes remotas nÃ£o autorizadas.
- Revelar portas ocultas por rootkits.
- Recuperar histÃ³rico de navegaÃ§Ã£o (mesmo se excluÃ­do do disco).

---

### 7. Eventos de Log
- Logs do Windows sÃ£o mapeados na memÃ³ria.
- Podem ser extraÃ­dos mesmo se apagados ou alterados.

#### ğŸ“‹ Exemplos de Uso:
- Detectar tentativas de forÃ§a bruta.
- Identificar backdoors (alteraÃ§Ãµes no firewall).
- Encontrar logs apagados.

#### ğŸ› ï¸ Ferramentas:
- **Microsoft Management Console (MMC)**
- **PowerShell**: `Get-Service`

---

### 8. MÃ³dulos do Kernel
- Lista de mÃ³dulos carregados no kernel via `PsLoadedModuleList`.
- Rootkits podem:
  - Desvincular entradas da lista.
  - Zerar metadados (`pool-scanning` ainda pode encontrar).

---

### 9. Linha do Tempo (Timeline)
- Combinar artefatos de memÃ³ria, arquivos e rede.
- Reconstruir sequÃªncia de eventos.

#### ğŸ› ï¸ Plugins do Volatility:
- `timeliner`
- `mftparser`
- `shellbags`

#### ğŸ” Ferramentas Externas:
- `log2timeline`: Extrai dados temporais de arquivos e logs.

---

### ğŸ“š ReferÃªncias
- LIGH, M.H. et al. *The Art of Memory Forensics*
- SIKORSKI, M.; HONIG, A. *Practical Malware Analysis*
- TANENBAUM, A.S. *OrganizaÃ§Ã£o Estruturada de Computadores*

---
