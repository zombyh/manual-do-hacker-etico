
## 📘 Resumo: Análise de Memória no Windows com Volatility

### 🎯 Objetivo da Aula
- Identificar vantagens do uso do **Volatility**.
- Reconhecer técnicas de **aquisição de memória**.
- Compreender **recursos internos do Windows** para análise forense.

---

## 🧠 Tópicos Principais

### 1. Introdução à Análise de Memória
- Muitas vezes o analista não recebe o malware, mas sim a máquina infectada.
- A análise de memória permite:
  - Ver processos em execução.
  - Identificar conexões de rede.
  - Recuperar comandos recentes.
  - Encontrar dados **apenas em RAM**: chaves de criptografia, código injetado, e-mails não criptografados, etc.

---

### 2. Volatility Framework
- Ferramenta de código aberto em Python.
- Usada para extrair artefatos de amostras de memória RAM.
- Suporta Windows, Linux e macOS (32 e 64 bits).
- Modular e extensível, com suporte da comunidade.

#### ❌ O que o Volatility **não é**:
- Não é ferramenta de aquisição de memória.
- Não possui interface gráfica.
- Não é imune a erros.

**Exemplo de comando:**
```bash
python vol.py -f memory.dmp --profile=Win7SP1x64 pslist
```

---

### 3. Aquisição de Memória
- Cópia da memória volátil para armazenamento não volátil.
- Requer planejamento e ferramentas robustas.

#### 🛠️ Ferramentas de Aquisição:
- **AccessData FTK Imager**
- **MoonSols Windows Memory Toolkit**
- **Winpmem** (código aberto)
- **FastDump**, **Memoryze**

---

### 4. Estruturas do Windows na Memória

#### 🔍 Objetos do Kernel
- Estruturas em C (`ExecutiveObjects`) organizam dados do sistema.
- Exemplo: `_POOL_HEADER` em alocações de kernel.

#### 🔍 Processos
- Cada processo tem espaço de memória virtual isolado.
- Contém: executável, DLLs, stacks, heaps, variáveis de ambiente.

#### 🔍 Plugins do Volatility para Processos:
- `pslist`: Lista processos (pode não mostrar ocultos).
- `pstree`: Mostra relação pai-filho.
- `psscan`: Busca por `_EPROCESS` (encontra processos ocultos).
- `psxview`: Compara listas de processos para detectar discrepâncias.

#### 🔍 Variáveis de Ambiente
- Apontadas pela `PEB` (Process Environment Block).
- Malwares podem criar variáveis para persistência.

#### 🔍 Registro do Windows
- Banco de dados de configurações do sistema.
- Mapeado na memória durante a execução.
- Pode conter:
  - Programas executados recentemente.
  - Hashes de senhas.
  - Chaves maliciosas.

---

### 5. Injeção de Código
- Técnica para executar código malicioso dentro de processos legítimos.

#### 🎯 Tipos de Injeção:
- **Injeção Remota de DLL**: Carrega DLL do disco via `LoadLibrary`.
- **Injeção Remota de Código**: Escreve código diretamente no processo.
- **Injeção Reflexiva de DLL**: DLL é carregada da memória, sem arquivo em disco.
- **Process Hollowing**: Substitui código de processo legítimo suspenso.

---

### 6. Investigação de Rede
- Malwares usam rede para C2, propagação, backdoor.

#### 🔌 Tipos de Artefatos de Rede:
- **Sockets**: Criados via Winsock, WinINet ou TDI (kernel).
- **Conexões**: Cliente/servidor.

#### 🧩 Objetivos do Analista:
- Identificar portas abertas suspeitas.
- Detectar conexões remotas não autorizadas.
- Revelar portas ocultas por rootkits.
- Recuperar histórico de navegação (mesmo se excluído do disco).

---

### 7. Eventos de Log
- Logs do Windows são mapeados na memória.
- Podem ser extraídos mesmo se apagados ou alterados.

#### 📋 Exemplos de Uso:
- Detectar tentativas de força bruta.
- Identificar backdoors (alterações no firewall).
- Encontrar logs apagados.

#### 🛠️ Ferramentas:
- **Microsoft Management Console (MMC)**
- **PowerShell**: `Get-Service`

---

### 8. Módulos do Kernel
- Lista de módulos carregados no kernel via `PsLoadedModuleList`.
- Rootkits podem:
  - Desvincular entradas da lista.
  - Zerar metadados (`pool-scanning` ainda pode encontrar).

---

### 9. Linha do Tempo (Timeline)
- Combinar artefatos de memória, arquivos e rede.
- Reconstruir sequência de eventos.

#### 🛠️ Plugins do Volatility:
- `timeliner`
- `mftparser`
- `shellbags`

#### 🔁 Ferramentas Externas:
- `log2timeline`: Extrai dados temporais de arquivos e logs.

---

### 10. Exercícios de Revisão

1. **O que NÃO é vantagem do Volatility?**  
   - ❌ **Baixo custo de aquisição** (já é gratuito)

2. **Ferramenta que NÃO faz aquisição de memória:**  
   - ❌ **Volatility** (só analisa)

3. **Responsável pela execução do código em um processo:**  
   - ✅ **Threads**

---

### 📚 Referências
- LIGH, M.H. et al. *The Art of Memory Forensics*
- SIKORSKI, M.; HONIG, A. *Practical Malware Analysis*
- TANENBAUM, A.S. *Organização Estruturada de Computadores*

---

### 🧩 Próximos Temas
- Análise de memória em Linux
- Aquisição de memória em Linux
- Arquitetura e peculiaridades do Linux

---
