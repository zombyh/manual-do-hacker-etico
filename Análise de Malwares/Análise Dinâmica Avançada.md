
## 📘 Resumo: Análise Dinâmica Avançada

### 📌 Visão Geral
- Esta aula aborda **análise dinâmica avançada** usando depuradores.
- Foco em duas ferramentas:
  - **OllyDbg**: depuração em modo de usuário.
  - **WinDbg**: depuração em modo kernel.

---

## 🛠️ Depuradores (Debuggers)

### 🔹 O que são?
- Softwares que permitem **testar e examinar a execução de um programa**.
- Fornecem uma **visão dinâmica** (em tempo real) do programa, diferente do disassembly (estático).
- Permitem:
  - Ver registradores, memória, argumentos de funções.
  - Alterar valores durante a execução.

### 🔹 Modo de Usuário vs. Modo Kernel
- **Modo Usuário**:
  - A maioria dos programas executa aqui.
  - Processos isolados, com própria memória.
  - Instruções restritas.
  - Se crashar, não afeta o SO.
- **Modo Kernel**:
  - SO e drivers.
  - Acesso total ao hardware.
  - Compartilham memória.
  - Crash = tela azul (BSOD).

---

## 🔍 OllyDbg – Depurador de Modo Usuário

### 🔸 Características
- Grátis, popular, com suporte a plugins.
- Interface com 4 janelas principais:

1. **Janela do Desmontador**: Código em assembly.
2. **Janela de Registradores**: Estado dos registradores.
3. **Janela da Pilha**: Estado da pilha do processo.
4. **Janela de Memória**: Visualização de qualquer região de memória.

### 🔸 Controles de Execução
- **Step Into**: Entra na função.
- **Step Over**: Executa a função sem entrar nela.
- **Run**: Continua a execução.
- **Run to Selection**: Executa até a instrução selecionada.
- **Breakpoints**: Pausa em pontos específicos.

### 🔸 Depuração de DLLs
- Usa `loaddll.exe` para carregar DLLs.
- Permite depurar `DllMain` e funções exportadas.

### 🔸 Mapeamento de Memória
- Mostra todas as seções de memória do processo.
- Útil para ver código, dados, DLLs carregadas.

### 🔸 Threads
- Visualização e controle de threads.
- Possibilidade de pausar, matar ou depurar threads específicas.

---

## ⚙️ WinDbg – Depurador de Modo Kernel

### 🔸 Uso Principal
- Depuração de **drivers**, **rootkits**, código em modo kernel.

### 🔸 Como Funciona o Kernel no Windows
- **Drivers**: Código que roda no kernel.
- **Device Objects**: Objetos que aplicativos acessam (ex: unidade D:).
- **DriverEntry**: Ponto de entrada do driver (como `DllMain` para DLLs).

### 🔸 Comandos Principais no WinDbg
- **`d`**: Exibe memória (ex: `da` para ASCII, `du` para Unicode).
- **`dwo`**: Lê ponteiro de 32 bits.
- **`bp`**: Define breakpoint (ex: `bp GetProcAddress "da dwo(esp+8); g"`).
- **`!devobj`**: Informações do objeto de dispositivo.
- **`!devhandles`**: Lista processos com handle para o dispositivo.

### 🔸 Rootkits e SSDT Hooking
- **SSDT (System Service Descriptor Table)**: Tabela de funções do kernel.
- **Hooking**: Rootkits alteram entradas na SSDT para redirecionar chamadas.
- Exemplo: Substituir `NtCreateFile` para ocultar arquivos.

---

## 🧪 Técnicas de Depuração

### 🔹 Tipos de Depuração
1. **Iniciar com Depurador**: Controle desde o início.
2. **Anexar a Processo**: Depurar programa já em execução.

### 🔹 Breakpoints
- Pausam a execução para inspeção.
- Exemplo: Breakpoint em `CreateFile` para ver nome do arquivo.

### 🔹 Modificação da Execução
- Alterar registradores (ex: EIP).
- Pular chamadas de função.
- Modificar valores na memória.

---

## 📚 Referências Sugeridas
- Anley (2007)  
- Sikorski & Honig (2012)  
- Tanenbaum (2010)  
- Matrosov: *Rootkits and Bootkits*

---
