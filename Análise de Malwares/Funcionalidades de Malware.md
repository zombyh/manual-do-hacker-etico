
## üìÅ Resumo: Funcionalidades de Malware

### üìå Introdu√ß√£o
- Malwares possuem **funcionalidades padr√£o** que podem ser identificadas e bloqueadas.
- Objetivos da aula:
  - Interpretar padr√µes de comportamento.
  - Diferenciar cifras simples de algoritmos criptogr√°ficos.
  - Identificar assinaturas de rede.

---

## üß© Tipos de Malware e Comportamentos

### 1. **Downloaders (Baixadores)**
- Baixam e executam outros malwares.
- Fun√ß√µes comuns: `URLDownloadtoFileA` + `WinExec`.
- S√£o a ‚Äúporta de entrada‚Äù para malwares mais complexos.

### 2. **Launchers (Iniciadores)**
- Executam outro aplicativo de forma secreta ou futura.
- Podem conter o malware embutido.

### 3. **Backdoors**
- Garantem **acesso remoto** √† m√°quina da v√≠tima.
- Caracter√≠sticas:
  - Implementam todas as funcionalidades necess√°rias.
  - Comunicam-se geralmente pela **porta 80 (HTTP)** ou **443 (HTTPS)**.
  - Podem usar **RATs** (Remote Administration Tools) para controle granular.

### 4. **Botnets vs. RATs**
| Botnets | RATs |
|---------|------|
| Controlam milhares de m√°quinas | Controlam poucas m√°quinas |
| Ataques em massa | Ataques direcionados |
| Controle centralizado (botmaster) | Controle individualizado por v√≠tima |

### 5. **Roubadores de Credenciais**
- Capturam credenciais de tr√™s formas:
  1. Durante o login.
  2. Buscando hashes ou senhas armazenadas no SO.
  3. Registrando teclas digitadas (keyloggers).

---

## üß† Mecanismos de Persist√™ncia

### 1. **Modifica√ß√£o do Registro do Windows**
- Registros de inicializa√ß√£o autom√°tica s√£o alterados para executar o malware.

### 2. **Trojaniza√ß√£o de Bin√°rios**
- C√≥digo malicioso √© injetado em bin√°rios leg√≠timos.
- Fluxo desviado para c√≥digo malicioso e depois retorna ao normal.

### 3. **Sequestro de Ordem de Carregamento de DLL**
- DLL maliciosa com nome igual √© colocada em diret√≥rio com **maior prioridade na ordem de carregamento**.
- Exemplo: substituir DLL do `system32` por uma vers√£o maliciosa em `system`.

---

## üîê Escalonamento de Privil√©gios

- A maioria dos usu√°rios √© **admin local** ‚Üí malware herda privil√©gios.
- T√©cnicas comuns:
  - Explora√ß√£o de falhas do SO.
  - Sequestro de DLL em processos com maior privil√©gio.
- Mesmo como admin, alguns processos rodam em **n√≠vel de sistema** ‚Üí malware precisa migrar para eles.

---

## üïµÔ∏è T√©cnicas de Oculta√ß√£o

### 1. **Carregadores (Loaders)**
- Ocultam malware na **se√ß√£o de recursos** de um PE.
- Extraem e executam o malware em mem√≥ria.

### 2. **Inje√ß√£o de Processo**
- C√≥digo malicioso √© injetado em processo leg√≠timo.
- Fun√ß√µes comuns:
  - `VirtualAllocEx` ‚Üí aloca mem√≥ria em processo externo.
  - `WriteProcessMemory` ‚Üí escreve c√≥digo malicioso.
- Tipos:
  - Inje√ß√£o de DLL
  - Inje√ß√£o direta de c√≥digo

---

## üîê Codifica√ß√£o de Dados

### 1. **Objetivos da Codifica√ß√£o**
- Criptografar comunica√ß√£o.
- Evitar detec√ß√£o por ferramentas de seguran√ßa.
- Ocultar configura√ß√µes, strings e funcionalidades.

### 2. **Cifras Simples**
- Exemplo: **XOR** e **Base64**.
- Vantagens: pouco c√≥digo, baixo consumo.
- Objetivo: dificultar an√°lise b√°sica.

### 3. **Criptografia Forte**
- Exemplos: **AES**, **RC4**.
- Desvantagem: bibliotecas grandes e menos port√°teis.
- Identifica√ß√£o:
  - Strings e imports relacionados.
  - Plugin **FindCrypt2** no IDA Pro.

---

## üåê Assinaturas de Rede

### 1. **Indicadores B√°sicos**
- IPs, portas, dom√≠nios, conte√∫do do tr√°fego.
- Usados em firewalls, DNS sinkholes, IDS/IPS.

### 2. **Estrat√©gia de An√°lise**
- Comece com logs, alertas e capturas de pacotes existentes.
- Evite executar o malware antes de analisar dados passivos.

### 3. **Gera√ß√£o de Assinaturas**
- Fonte principal: **dados embutidos no c√≥digo**.
- Quanto mais conte√∫do manual, maior a chance de erro do autor.
- Use **m√∫ltiplas assinaturas** para diferentes partes do c√≥digo.

---

## ‚úÖ Exemplo Pr√°tico de An√°lise de Rede
- Malware faz:
  1. Consulta DNS para `www.malicioso.com.br`
  2. Requisi√ß√£o HTTP GET para IP retornado
  3. Conex√£o direta a IP sem DNS
- **Indicadores criados**: dom√≠nio, IP do DNS, IP direto, m√©todo HTTP ‚Üí **pelo menos 4 indicadores**.

---

## üìö Pr√≥ximos T√≥picos
- Anti-desmontagem
- Anti-depura√ß√£o
- Anti-m√°quinas virtuais

---

## üîó Explore Mais
- Crie assinaturas para IDS/IPS: [Snort](https://www.snort.org/)

---
